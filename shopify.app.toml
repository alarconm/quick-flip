# Cardflow Labs - TradeUp Shopify App Configuration
# https://shopify.dev/docs/apps/tools/cli/configuration
#
# TradeUp: Store Credit, Rewards & Membership for Shopify
# https://cardflowlabs.com

name = "TradeUp by Cardflow Labs"
client_id = "f27841c5cf965100dfa81a212d7d9c10"
application_url = "https://app.cardflowlabs.com"
embedded = true

[access_scopes]
scopes = "read_customers,write_customers,read_orders,read_products,write_products,read_inventory,read_fulfillments"

[auth]
redirect_urls = [
  "https://cardflowlabs.com/api/shopify/callback",
  "https://app.cardflowlabs.com/api/shopify/callback",
  "https://localhost:3000/api/shopify/callback"
]

[webhooks]
api_version = "2024-10"

[[webhooks.subscriptions]]
topics = ["customers/create"]
uri = "/webhook/customers/create"

[[webhooks.subscriptions]]
topics = ["customers/update"]
uri = "/webhook/customers/update"

[[webhooks.subscriptions]]
topics = ["customers/delete"]
uri = "/webhook/customers/delete"

[[webhooks.subscriptions]]
topics = ["orders/create"]
uri = "/webhook/orders/create"

[[webhooks.subscriptions]]
topics = ["orders/paid"]
uri = "/webhook/orders/paid"

[[webhooks.subscriptions]]
topics = ["orders/cancelled"]
uri = "/webhook/orders/cancelled"

[[webhooks.subscriptions]]
topics = ["orders/fulfilled"]
uri = "/webhook/orders/fulfilled"

[[webhooks.subscriptions]]
topics = ["refunds/create"]
uri = "/webhook/refunds/create"

[[webhooks.subscriptions]]
topics = ["products/create"]
uri = "/webhook/products/create"

[[webhooks.subscriptions]]
topics = ["app/uninstalled"]
uri = "/webhook/app/uninstalled"

[[webhooks.subscriptions]]
topics = ["shop/update"]
uri = "/webhook/shop/update"

[[webhooks.subscriptions]]
topics = ["app_subscriptions/update"]
uri = "/webhook/shopify-billing/subscriptions"

[[webhooks.subscriptions]]
topics = ["app_purchases_one_time/update"]
uri = "/webhook/shopify-billing/purchases"

# GDPR Mandatory Webhooks (required for App Store)
[[webhooks.subscriptions]]
topics = ["customers/redact"]
uri = "/webhook/customers/redact"

[[webhooks.subscriptions]]
topics = ["shop/redact"]
uri = "/webhook/shop/redact"

[[webhooks.subscriptions]]
topics = ["customers/data_request"]
uri = "/webhook/customers/data_request"

[build]
automatically_update_urls_on_dev = true

# ==================== Shopify Flow Integration ====================
# Flow Triggers - Events our app sends to start Flow workflows
# Flow Actions - Actions Flow can call in our app

[flow]
# Flow triggers that can start workflows
[[flow.triggers]]
title = "TradeUp: Member Enrolled"
description = "Triggered when a new member enrolls in the loyalty program"
uri = "/flow/triggers/member-enrolled"

[[flow.triggers]]
title = "TradeUp: Tier Changed"
description = "Triggered when a member's tier is upgraded or downgraded"
uri = "/flow/triggers/tier-changed"

[[flow.triggers]]
title = "TradeUp: Trade-In Completed"
description = "Triggered when a trade-in batch is completed and credit issued"
uri = "/flow/triggers/trade-in-completed"

[[flow.triggers]]
title = "TradeUp: Store Credit Issued"
description = "Triggered when store credit is added to a member's account"
uri = "/flow/triggers/credit-issued"

# Flow actions that can be used in workflows
[[flow.actions]]
title = "TradeUp: Add Store Credit"
description = "Add store credit to a customer's account"
uri = "/flow/actions/add-credit"

[[flow.actions]]
title = "TradeUp: Change Member Tier"
description = "Upgrade or downgrade a member's tier"
uri = "/flow/actions/change-tier"

[[flow.actions]]
title = "TradeUp: Get Member Info"
description = "Retrieve membership information for a customer"
uri = "/flow/actions/get-member"
