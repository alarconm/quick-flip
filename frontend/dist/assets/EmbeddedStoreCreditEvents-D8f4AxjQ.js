import{b as He,u as Ge,c as M,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as l}from"./vendor-router-CdtyvhQv.js";import{a as E,g as A}from"./index-CY-ZAv3_.js";import{c as Qe,u as Je}from"./useShopifyData-DF9ib8De.js";import{P as Ce,B as T,a0 as Te,v as Ke,L as le,C as m,a as c,T as n,u as de,h as x,I as P,a5 as ce,c as b,a6 as Ye,a9 as Ze,b as ue,D as ke,t as y,Z as Ve,W as Xe,E as et,M as O,e as W,g as v,f as he,z as w,G as K,_ as k,O as De,Y,$ as Ee,a1 as tt}from"./vendor-polaris-1WqYVNpP.js";import{T as st}from"./vendor-appbridge-DL6abzKC.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";function it(){const[r,d]=l.useState(()=>{if(typeof window>"u")return{isMobile:!1,isTablet:!1};const u=window.innerWidth;return{isMobile:u<768,isTablet:u>=768&&u<1024}});return l.useEffect(()=>{const u=()=>{const h=window.innerWidth;d({isMobile:h<768,isTablet:h>=768&&h<1024})};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),r}const nt=[{label:"Monday",value:"0"},{label:"Tuesday",value:"1"},{label:"Wednesday",value:"2"},{label:"Thursday",value:"3"},{label:"Friday",value:"4"},{label:"Saturday",value:"5"},{label:"Sunday",value:"6"}],Ae=[{label:"Never expires",value:""},{label:"30 days",value:"30"},{label:"60 days",value:"60"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"1 year",value:"365"}];async function at(r){const d=await E(`${A()}/promotions/promotions`,r);if(!d.ok)throw new Error("Failed to fetch events");return{events:((await d.json()).promotions||[]).filter(j=>j.promo_type==="purchase_cashback"||j.promo_type==="trade_in_bonus")}}async function rt(r,d){const u=await E(`${A()}/promotions/promotions`,r,{method:"POST",body:JSON.stringify(d)});if(!u.ok)throw new Error("Failed to create event");return u.json()}async function ot(r,d,u){const h=await E(`${A()}/promotions/promotions/${d}`,r,{method:"PUT",body:JSON.stringify(u)});if(!h.ok)throw new Error("Failed to update event");return h.json()}async function lt(r,d){if(!(await E(`${A()}/promotions/promotions/${d}`,r,{method:"DELETE"})).ok)throw new Error("Failed to delete event")}function I(r){return r?new Date(r).toISOString().replace(/\.\d{3}Z$/,"Z"):""}function B(r){const d=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),h=String(r.getDate()).padStart(2,"0"),j=String(r.getHours()).padStart(2,"0"),Z=String(r.getMinutes()).padStart(2,"0");return`${d}-${u}-${h}T${j}:${Z}`}async function dt(r,d,u){const h=new URLSearchParams({start_datetime:I(d),end_datetime:I(u)}),j=await E(`${A()}/store-credit-events/sources?${h}`,r);if(!j.ok)throw new Error("Failed to fetch order sources");return j.json()}async function ct(r,d){const u={...d,start_datetime:I(d.start_datetime),end_datetime:I(d.end_datetime)},h=await E(`${A()}/store-credit-events/preview`,r,{method:"POST",body:JSON.stringify(u)});if(!h.ok)throw new Error("Failed to preview event");return h.json()}async function ut(r,d){const u={...d,start_datetime:I(d.start_datetime),end_datetime:I(d.end_datetime)},h=await E(`${A()}/store-credit-events/run`,r,{method:"POST",body:JSON.stringify(u)});if(!h.ok)throw new Error("Failed to run event");return h.json()}function ft({shop:r}){const d=He(),{isMobile:u,isTablet:h}=it(),[j,Z]=l.useState(0),[Fe,F]=l.useState(!1),[L,V]=l.useState(null),[Me,q]=l.useState(!1),[X,pe]=l.useState(null),[Pe,U]=l.useState(!1),[S,R]=l.useState(null),[_,H]=l.useState(null),[me,ee]=l.useState([]),[s,p]=l.useState({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:"",ends_at:"",daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],audience:"members_only",active:!0,credit_expiration_days:""}),[i,g]=l.useState({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[],audience:"all_customers"}),[te,xe]=l.useState(""),[se,_e]=l.useState(""),[ie,ge]=l.useState(""),[ne,ye]=l.useState(""),{data:C}=Qe(r),{data:f}=Je(r),{data:Oe,isLoading:Be}=Ge({queryKey:["scheduled-events",r],queryFn:()=>at(r),enabled:!!r}),Ie=l.useMemo(()=>{if(!C?.tags)return[];const t=(ie||"").toLowerCase();return(t?C.tags.filter(a=>(a||"").toLowerCase().includes(t)):C.tags).filter(a=>a).map(a=>({value:a,label:a}))},[C,ie]),Le=l.useMemo(()=>{if(!f?.collections)return[];const t=(ne||"").toLowerCase();return(t?f.collections.filter(a=>(a?.title||"").toLowerCase().includes(t)):f.collections).filter(a=>a?.title).map(a=>({value:a.id,label:a.title}))},[f,ne]),Re=l.useMemo(()=>{if(!C?.tags)return[];const t=(te||"").toLowerCase();return(t?C.tags.filter(a=>(a||"").toLowerCase().includes(t)):C.tags).filter(a=>a).map(a=>({value:a,label:a}))},[C,te]),ze=l.useMemo(()=>{if(!f?.collections)return[];const t=(se||"").toLowerCase();return(t?f.collections.filter(a=>(a?.title||"").toLowerCase().includes(t)):f.collections).filter(a=>a?.title).map(a=>({value:a.id,label:a.title}))},[f,se]),ae=M({mutationFn:t=>rt(r,t),onSuccess:()=>{d.invalidateQueries({queryKey:["scheduled-events"]}),F(!1),G()}}),re=M({mutationFn:({id:t,data:o})=>ot(r,t,o),onSuccess:()=>{d.invalidateQueries({queryKey:["scheduled-events"]}),F(!1),V(null),G()}}),je=M({mutationFn:t=>lt(r,t),onSuccess:()=>{d.invalidateQueries({queryKey:["scheduled-events"]}),q(!1),pe(null)}}),z=M({mutationFn:({start:t,end:o})=>dt(r,t,o),onSuccess:t=>ee(t.sources)}),fe=M({mutationFn:()=>ct(r,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized,collection_ids:i.collection_ids.length>0?i.collection_ids:void 0,product_tags:i.product_tags.length>0?i.product_tags:void 0,audience:i.audience}),onSuccess:t=>{R(t),H(null)}}),be=M({mutationFn:()=>ut(r,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized,expires_at:i.credit_expiration_days?new Date(Date.now()+parseInt(i.credit_expiration_days)*24*60*60*1e3).toISOString():void 0,collection_ids:i.collection_ids.length>0?i.collection_ids:void 0,product_tags:i.product_tags.length>0?i.product_tags:void 0,audience:i.audience}),onSuccess:t=>{H(t),R(null)}}),G=l.useCallback(()=>{const t=new Date,o=new Date(t.getTime()+10080*60*1e3);p({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:B(t),ends_at:B(o),daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],audience:"members_only",active:!0,credit_expiration_days:""}),ge(""),ye("")},[]),oe=l.useCallback(()=>{g({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[],audience:"all_customers"}),R(null),H(null),ee([]),xe(""),_e("")},[]),D=l.useCallback(t=>{if(G(),t){const o=new Date,a=t.duration_hours?new Date(o.getTime()+t.duration_hours*60*60*1e3):new Date(o.getTime()+10080*60*1e3);p($=>({...$,name:t.name,description:t.description,bonus_percent:t.bonus_percent,daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days||[],starts_at:B(o),ends_at:B(a)}))}V(null),F(!0)},[G]),Ne=l.useCallback(t=>{V(t),p({name:t.name,description:t.description||"",promo_type:t.promo_type,bonus_percent:t.bonus_percent,starts_at:t.starts_at?.slice(0,16)||"",ends_at:t.ends_at?.slice(0,16)||"",daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days?t.active_days.split(","):[],product_tags_filter:t.product_tags_filter||[],collection_ids:t.collection_ids||[],tier_restriction:t.tier_restriction||[],audience:t.audience||"members_only",active:t.active,credit_expiration_days:""}),F(!0)},[]),Q=l.useCallback((t,o)=>{const a=new Date,$=t?new Date(a.getTime()+t*60*60*1e3):new Date(a.getTime()+10800*1e3),J=B(a),we=B($);g({start_datetime:J,end_datetime:we,sources:[],credit_percent:o||10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[],audience:"all_customers"}),R(null),H(null),ee([]),U(!0),z.mutate({start:J,end:we})},[z]),ve=l.useCallback((t,o)=>{const a={...i,[t]:o};g(a),a.start_datetime&&a.end_datetime&&z.mutate({start:a.start_datetime,end:a.end_datetime})},[i,z]),$e=l.useCallback(()=>{const t={name:s.name,description:s.description||null,promo_type:s.promo_type,bonus_percent:s.bonus_percent,bonus_flat:0,multiplier:1,starts_at:s.starts_at,ends_at:s.ends_at,daily_start_time:s.daily_start_time||null,daily_end_time:s.daily_end_time||null,active_days:s.active_days.length>0?s.active_days.join(","):null,product_tags_filter:s.product_tags_filter.length>0?s.product_tags_filter:null,collection_ids:s.collection_ids.length>0?s.collection_ids:null,tier_restriction:s.tier_restriction.length>0?s.tier_restriction:null,audience:s.audience,channel:"all",stackable:!0,active:s.active,credit_expiration_days:s.credit_expiration_days?parseInt(s.credit_expiration_days):null};L?re.mutate({id:L.id,data:t}):ae.mutate(t)},[s,L,ae,re]),N=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),We=t=>t.active?t.is_active_now?e.jsx(y,{tone:"success",children:"Active Now"}):t.starts_at&&new Date(t.starts_at)>new Date?e.jsx(y,{tone:"info",children:"Scheduled"}):e.jsx(y,{tone:"warning",children:"Ended"}):e.jsx(y,{children:"Disabled"}),qe=t=>{const o=[];if(t.daily_start_time&&t.daily_end_time&&o.push(`${t.daily_start_time} - ${t.daily_end_time}`),t.active_days){const a=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],$=t.active_days.split(",").map(J=>a[parseInt(J)]);o.push($.join(", "))}return o.length>0?o.join(" on "):"All times"},Ue=[{id:"scheduled",content:"Live Promotions",panelID:"scheduled-panel"},{id:"bulk",content:"Post-Event Rewards",panelID:"bulk-panel"}];if(!r)return e.jsx(Ce,{title:"Store Credit Events",children:e.jsx(T,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});const Se=Oe?.events||[];return e.jsxs(e.Fragment,{children:[e.jsx(st,{title:"Store Credit Events",children:e.jsx("button",{variant:"primary",onClick:()=>D(),children:"New Event"})}),e.jsxs(Ce,{title:"Store Credit Events",subtitle:"Create bonus events to reward customers with store credit",primaryAction:{content:"New Live Promotion",icon:Ke,onAction:()=>D()},secondaryActions:[{content:"Run Bulk Event",icon:Te,onAction:()=>Q()}],children:[e.jsxs(le,{children:[e.jsx(le.Section,{children:e.jsx(m,{children:e.jsxs(c,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Quick Start Templates"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Use a template to quickly create common bonus events"}),e.jsxs(de,{columns:u?1:h?2:4,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(c,{gap:"200",children:[e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsx(P,{source:ce}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Black Friday"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+10% store credit on all purchases during Black Friday weekend"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>D({name:"Black Friday Bonus",description:"Earn 10% store credit on all purchases this Black Friday weekend!",bonus_percent:10,duration_hours:72}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(c,{gap:"200",children:[e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsx(P,{source:Ye}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Saturday 6-9pm bonus for in-store trades and purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>D({name:"Saturday Trade Night",description:"Extra 10% store credit on Saturday evening purchases!",bonus_percent:10,daily_start_time:"18:00",daily_end_time:"21:00",active_days:["5"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(c,{gap:"200",children:[e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsx(P,{source:ce}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Warrior"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+5% store credit on all weekend purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>D({name:"Weekend Bonus",description:"Earn 5% store credit on all weekend purchases!",bonus_percent:5,active_days:["5","6"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(c,{gap:"200",children:[e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsx(P,{source:ce}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Grand Opening"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+15% store credit on opening day purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>D({name:"Grand Opening Bonus",description:"Celebrate our grand opening with 15% store credit!",bonus_percent:15,duration_hours:24}),children:"Use Template"})})]})})})]})]})})}),e.jsx(le.Section,{children:e.jsxs(Ze,{tabs:Ue,selected:j,onSelect:Z,children:[j===0&&e.jsx(m,{children:Be?e.jsx(c,{gap:"400",children:[1,2,3].map(t=>e.jsx(ue,{paddingBlock:"300",children:e.jsxs(x,{gap:"400",blockAlign:"center",children:[e.jsx(ue,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"150px"}),e.jsx(ue,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"100px"})]})},t))}):Se.length>0?e.jsx(ke,{columnContentTypes:["text","text","text","text","text","text","text"],headings:["Event Name","Audience","Bonus","Schedule","Date Range","Status","Actions"],rows:Se.map(t=>[e.jsxs(c,{gap:"100",children:[e.jsx(n,{as:"span",fontWeight:"semibold",children:t.name}),t.product_tags_filter&&t.product_tags_filter.length>0&&e.jsx(x,{gap:"100",children:t.product_tags_filter.slice(0,2).map(o=>e.jsx(y,{size:"small",children:o},o))})]},t.id),e.jsx(y,{tone:t.audience==="all_customers"?"info":void 0,children:t.audience==="all_customers"?"All Customers":"Members Only"},`audience-${t.id}`),e.jsx(y,{tone:"success",children:`+${t.bonus_percent}%`},t.id),qe(t),e.jsxs(n,{as:"span",variant:"bodySm",children:[t.starts_at?new Date(t.starts_at).toLocaleDateString():"—"," - ",t.ends_at?new Date(t.ends_at).toLocaleDateString():"—"]},t.id),We(t),e.jsxs(x,{gap:"200",children:[e.jsx(b,{size:"slim",icon:Ve,onClick:()=>Ne(t),accessibilityLabel:`Edit ${t.name}`}),e.jsx(b,{size:"slim",icon:Xe,tone:"critical",onClick:()=>{pe(t),q(!0)},accessibilityLabel:`Delete ${t.name}`})]},t.id)])}):e.jsx(et,{heading:"No live promotions yet",action:{content:"Create your first event",onAction:()=>D()},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Schedule store credit bonus events to reward your customers during special periods."})})}),j===1&&e.jsxs(c,{gap:"400",children:[e.jsx(m,{children:e.jsxs(c,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Send Post-Event Rewards"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue store credit to customers based on their past orders. Great for rewarding customers after a busy sales period."}),e.jsxs(de,{columns:u?1:h?2:3,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 10% credit for orders from the last 3 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>Q(3,10),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 5% credit for orders from the last 48 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",onClick:()=>Q(48,5),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Custom Event"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Configure your own date range and credit percentage"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(b,{size:"slim",variant:"primary",onClick:()=>Q(),children:"Create Custom"})})]})})})]})]})}),e.jsx(m,{children:e.jsxs(c,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"How Bulk Events Work"}),e.jsxs(c,{gap:"200",children:[e.jsxs(x,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"1"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Set Date Range:"})," Choose the period to include orders from"]})]}),e.jsxs(x,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"2"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Select Sources:"})," Filter by POS, Web, or all channels"]})]}),e.jsxs(x,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"3"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Preview:"})," See exactly how much credit will be issued"]})]}),e.jsxs(x,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"success",children:"4"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Apply:"})," Issue store credit to all qualifying customers"]})]})]})]})})]})]})})]}),e.jsx(O,{open:Fe,onClose:()=>F(!1),title:L?"Edit Live Promotion":"New Live Promotion",primaryAction:{content:L?"Save Changes":"Create Event",onAction:$e,loading:ae.isPending||re.isPending},secondaryActions:[{content:"Cancel",onAction:()=>F(!1)}],children:e.jsx(O.Section,{children:e.jsxs(W,{children:[e.jsx(v,{label:"Event Name",value:s.name,onChange:t=>p({...s,name:t}),autoComplete:"off",requiredIndicator:!0,placeholder:"e.g., Black Friday Bonus, Saturday Trade Night"}),e.jsx(v,{label:"Description",value:s.description,onChange:t=>p({...s,description:t}),multiline:2,autoComplete:"off",helpText:"Shown to customers in their account"}),e.jsx(he,{label:"Bonus Type",options:[{label:"Purchase Cashback (% of order total)",value:"purchase_cashback"},{label:"Trade-In Bonus (% extra on trade-ins)",value:"trade_in_bonus"}],value:s.promo_type,onChange:t=>p({...s,promo_type:t})}),e.jsx(v,{label:"Bonus Percentage",type:"number",value:s.bonus_percent.toString(),onChange:t=>p({...s,bonus_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order/trade-in value to credit"}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Who Should Receive This Bonus?"}),e.jsx(K,{title:"Target Audience",titleHidden:!0,choices:[{label:"Members Only",value:"members_only",helpText:"Only enrolled TradeUp members receive the bonus"},{label:"All Customers Who Purchase",value:"all_customers",helpText:"Any customer who meets criteria gets store credit"}],selected:[s.audience],onChange:t=>p({...s,audience:t[0]})}),s.audience==="all_customers"&&e.jsx(T,{tone:"info",children:e.jsx("p",{children:"Both members and non-members will receive store credit directly to their Shopify account. Great for acquisition campaigns!"})}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Date Range"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"The event will be active from start date through end date"}),e.jsxs(W.Group,{children:[e.jsx(v,{label:"Start Date",type:"date",value:s.starts_at.split("T")[0],onChange:t=>p({...s,starts_at:t+"T00:00"}),autoComplete:"off",requiredIndicator:!0}),e.jsx(v,{label:"End Date",type:"date",value:s.ends_at.split("T")[0],onChange:t=>p({...s,ends_at:t+"T23:59"}),autoComplete:"off",requiredIndicator:!0})]}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Daily Time Window (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Limit this bonus to specific hours each day (e.g., 6-9pm trade nights)"}),e.jsxs(W.Group,{children:[e.jsx(v,{label:"Daily Start Time",type:"time",value:s.daily_start_time,onChange:t=>p({...s,daily_start_time:t}),autoComplete:"off",helpText:"e.g., 18:00 for 6 PM"}),e.jsx(v,{label:"Daily End Time",type:"time",value:s.daily_end_time,onChange:t=>p({...s,daily_end_time:t}),autoComplete:"off",helpText:"e.g., 21:00 for 9 PM"})]}),e.jsx(K,{title:"Active Days",choices:nt,selected:s.active_days,onChange:t=>p({...s,active_days:t}),allowMultiple:!0}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Product Filters (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Only apply this bonus to specific products"}),e.jsxs(c,{gap:"200",children:[e.jsx(k,{options:Ie,selected:s.product_tags_filter,onSelect:t=>p({...s,product_tags_filter:t}),textField:e.jsx(k.TextField,{label:"Product Tags",value:ie,onChange:ge,placeholder:"e.g., pokemon, sports-cards",prefix:e.jsx(P,{source:De}),autoComplete:"off"}),allowMultiple:!0}),s.product_tags_filter.length>0&&e.jsx(x,{gap:"100",wrap:!0,children:s.product_tags_filter.map(t=>e.jsx(Y,{onRemove:()=>p({...s,product_tags_filter:s.product_tags_filter.filter(o=>o!==t)}),children:t},t))})]}),e.jsxs(c,{gap:"200",children:[e.jsx(k,{options:Le,selected:s.collection_ids,onSelect:t=>p({...s,collection_ids:t}),textField:e.jsx(k.TextField,{label:"Collections",value:ne,onChange:ye,placeholder:"Search collections...",prefix:e.jsx(P,{source:De}),autoComplete:"off"}),allowMultiple:!0}),s.collection_ids.length>0&&e.jsx(x,{gap:"100",wrap:!0,children:s.collection_ids.map(t=>{const o=f?.collections?.find(a=>a?.id===t);return e.jsx(Y,{onRemove:()=>p({...s,collection_ids:s.collection_ids.filter(a=>a!==t)}),children:o?.title||t},t)})})]}),e.jsx(w,{}),e.jsx(he,{label:"Credit Expiration",options:Ae,value:s.credit_expiration_days,onChange:t=>p({...s,credit_expiration_days:t}),helpText:"How long before credited amounts expire"}),e.jsx(Ee,{label:"Event is active",checked:s.active,onChange:t=>p({...s,active:t})})]})})}),e.jsx(O,{open:Me,onClose:()=>q(!1),title:"Delete Event",primaryAction:{content:"Delete",destructive:!0,onAction:()=>X&&je.mutate(X.id),loading:je.isPending},secondaryActions:[{content:"Cancel",onAction:()=>q(!1)}],children:e.jsx(O.Section,{children:e.jsxs(n,{as:"p",children:['Are you sure you want to delete "',X?.name,'"? This action cannot be undone.']})})}),e.jsx(O,{open:Pe,onClose:()=>{U(!1),oe()},title:"Run Bulk Store Credit Event",size:"large",primaryAction:S&&!_?{content:"Apply Credits",icon:Te,onAction:()=>be.mutate(),loading:be.isPending}:_?{content:"Done",onAction:()=>{U(!1),oe()}}:{content:"Preview (Dry Run)",icon:tt,onAction:()=>fe.mutate(),loading:fe.isPending,disabled:!i.start_datetime||!i.end_datetime||i.sources.length===0},secondaryActions:_?[]:[{content:"Cancel",onAction:()=>{U(!1),oe()}}],children:e.jsx(O.Section,{children:_?e.jsxs(c,{gap:"400",children:[e.jsx(T,{title:_.success_count>0?"Event Completed Successfully!":"Event Completed",tone:_.failure_count>0?"warning":"success",children:e.jsxs("p",{children:["Issued ",N(_.total_credit_issued)," in store credit to ",_.success_count," customers.",_.failure_count>0&&` ${_.failure_count} failed.`]})}),_.errors&&_.errors.length>0&&e.jsx(m,{children:e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",tone:"critical",children:"Errors"}),_.errors.slice(0,10).map((t,o)=>e.jsx(n,{as:"p",variant:"bodySm",children:t},o))]})})]}):S?e.jsxs(c,{gap:"400",children:[e.jsx(T,{title:"Preview Results",tone:"info",children:e.jsx("p",{children:'This is a dry run. No credits have been issued yet. Review the data below and click "Apply Credits" to proceed.'})}),e.jsxs(de,{columns:u||h?2:4,gap:"300",children:[e.jsx(m,{children:e.jsxs(c,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Orders"}),e.jsx(n,{as:"p",variant:"headingLg",children:S.summary.total_orders})]})}),e.jsx(m,{children:e.jsxs(c,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Unique Customers"}),e.jsx(n,{as:"p",variant:"headingLg",children:S.summary.unique_customers})]})}),e.jsx(m,{children:e.jsxs(c,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Order Value"}),e.jsx(n,{as:"p",variant:"headingLg",children:N(S.summary.total_order_value)})]})}),e.jsx(m,{children:e.jsxs(c,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Credit to Issue"}),e.jsx(n,{as:"p",variant:"headingLg",tone:"success",children:N(S.summary.total_credit_to_issue)})]})})]}),S.top_customers&&S.top_customers.length>0&&e.jsx(m,{children:e.jsxs(c,{gap:"300",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Top Customers by Credit"}),e.jsx(ke,{columnContentTypes:["text","text","numeric","numeric","numeric"],headings:["Customer","Email","Orders","Spent","Credit"],rows:S.top_customers.slice(0,5).map(t=>[t.name||"Guest",t.email||"-",t.order_count||0,N(t.total_spent||0),e.jsx(y,{tone:"success",children:N(t.credit_amount||0)},t.customer_id)])})]})}),e.jsx(b,{onClick:()=>R(null),variant:"plain",children:"Back to Edit"})]}):e.jsxs(W,{children:[e.jsx(T,{tone:"info",children:e.jsx("p",{children:'Reward customers for past purchases. Set your date range and filters, then click "Preview" to see who qualifies before sending credits.'})}),e.jsxs(W.Group,{children:[e.jsx(v,{label:"Start Date & Time",type:"datetime-local",value:i.start_datetime,onChange:t=>ve("start_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created after this time"}),e.jsx(v,{label:"End Date & Time",type:"datetime-local",value:i.end_datetime,onChange:t=>ve("end_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created before this time"})]}),e.jsx(v,{label:"Credit Percentage",type:"number",value:i.credit_percent.toString(),onChange:t=>g({...i,credit_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order total to issue as store credit"}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Who Should Receive This Credit?"}),e.jsx(K,{title:"Target Audience",titleHidden:!0,choices:[{label:"All Customers Who Purchased (Recommended)",value:"all_customers",helpText:"Any customer with orders in the date range gets credit"},{label:"Members Only",value:"members_only",helpText:"Only enrolled TradeUp members receive the credit"}],selected:[i.audience],onChange:t=>g({...i,audience:t[0]})}),i.audience==="all_customers"&&e.jsx(T,{tone:"info",children:e.jsx("p",{children:"Store credit will be issued directly to customers' Shopify accounts, including those who aren't members. Great for acquisition campaigns!"})}),i.audience==="members_only"&&e.jsx(T,{tone:"warning",children:e.jsx("p",{children:"Only enrolled TradeUp members will receive credit. Non-members who made purchases in this period will be skipped."})}),e.jsx(w,{}),e.jsxs(c,{gap:"200",children:[e.jsxs(n,{as:"span",variant:"bodyMd",children:["Order Sources ",e.jsx(n,{as:"span",tone:"critical",children:"*"})]}),z.isPending?e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Loading available sources..."}):me.length>0?e.jsx(K,{title:"",choices:me.map(t=>({label:`${t.name} (${t.count} orders)`,value:t.name})),selected:i.sources,onChange:t=>g({...i,sources:t}),allowMultiple:!0}):i.start_datetime&&i.end_datetime?e.jsx(T,{tone:"warning",children:e.jsx("p",{children:"No orders found in this date range. Try adjusting the dates."})}):e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Select start and end dates to see available order sources."})]}),e.jsx(w,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Product Filters (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Narrow down to orders containing specific products. Leave empty to include all orders."}),e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodyMd",children:"Collections"}),e.jsx(k,{options:ze,selected:i.collection_ids,onSelect:t=>g({...i,collection_ids:t}),textField:e.jsx(k.TextField,{label:"",onChange:_e,value:se,placeholder:"Search collections...",autoComplete:"off"}),allowMultiple:!0,listTitle:"Available Collections"}),i.collection_ids.length>0&&e.jsx(x,{gap:"100",wrap:!0,children:i.collection_ids.map(t=>{const o=f?.collections?.find(a=>a.id===t);return e.jsx(Y,{onRemove:()=>g({...i,collection_ids:i.collection_ids.filter(a=>a!==t)}),children:o?.title||t},t)})})]}),e.jsxs(c,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodyMd",children:"Product Tags"}),e.jsx(k,{options:Re,selected:i.product_tags,onSelect:t=>g({...i,product_tags:t}),textField:e.jsx(k.TextField,{label:"",onChange:xe,value:te,placeholder:"Search tags...",autoComplete:"off"}),allowMultiple:!0,listTitle:"Available Tags"}),i.product_tags.length>0&&e.jsx(x,{gap:"100",wrap:!0,children:i.product_tags.map(t=>e.jsx(Y,{onRemove:()=>g({...i,product_tags:i.product_tags.filter(o=>o!==t)}),children:t},t))})]}),e.jsx(w,{}),e.jsx(he,{label:"Credit Expiration",options:Ae,value:i.credit_expiration_days,onChange:t=>g({...i,credit_expiration_days:t}),helpText:"How long before issued credits expire"}),e.jsx(Ee,{label:"Include authorized (unpaid) orders",checked:i.include_authorized,onChange:t=>g({...i,include_authorized:t})})]})})})]})]})}export{ft as EmbeddedStoreCreditEvents,ft as default};
