import{b as R,u as x,c as v,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as C}from"./vendor-router-CdtyvhQv.js";import{a as g,g as b}from"./index-BN0IhMzD.js";import{P as S,C as u,a as d,l as q,T as r,aa as k,L as j,h as y,$ as s,b as M,a7 as W,c as T,z as p,e as l,g as h,f as m,M as I,B as D}from"./vendor-polaris-psd3hcVR.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";async function G(t){const o=await g(`${b()}/widget-builder/config`,t);if(!o.ok)throw new Error("Failed to fetch widget config");return o.json()}async function $(t){const o=await g(`${b()}/widget-builder/themes`,t);if(!o.ok)throw new Error("Failed to fetch themes");return o.json()}async function K(t){const o=await g(`${b()}/widget-builder/embed-code`,t);if(!o.ok)throw new Error("Failed to fetch embed code");return o.json()}const Q=[{label:"Bottom Right",value:"bottom-right"},{label:"Bottom Left",value:"bottom-left"},{label:"Right Tab",value:"right-tab"},{label:"Left Tab",value:"left-tab"}],H=[{label:"Gift",value:"gift"},{label:"Star",value:"star"},{label:"Heart",value:"heart"},{label:"Trophy",value:"trophy"},{label:"Custom",value:"custom"}],U=[{label:"Small",value:"small"},{label:"Medium",value:"medium"},{label:"Large",value:"large"}],J=[{label:"Slide",value:"slide"},{label:"Fade",value:"fade"},{label:"None",value:"none"}];function ie({shop:t}){const[o,E]=C.useState(0),[_,f]=C.useState(!1),w=R(),{data:P,isLoading:B}=x({queryKey:["widget-builder-config",t],queryFn:()=>G(t),enabled:!!t}),{data:F}=x({queryKey:["widget-builder-themes",t],queryFn:()=>$(t),enabled:!!t}),{data:O}=x({queryKey:["widget-builder-embed-code",t],queryFn:()=>K(t),enabled:_&&!!t}),i=v({mutationFn:async n=>{const c=await g(`${b()}/widget-builder/config`,t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!c.ok)throw new Error("Failed to update config");return c.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["widget-builder-config",t]})}}),z=v({mutationFn:async n=>{const c=await g(`${b()}/widget-builder/themes/${n}/apply`,t,{method:"POST"});if(!c.ok)throw new Error("Failed to apply theme");return c.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["widget-builder-config",t]})}}),a=P?.config,A=F?.themes||[],L=[{id:"appearance",content:"Appearance",panelID:"appearance-panel"},{id:"content",content:"Content",panelID:"content-panel"},{id:"behavior",content:"Behavior",panelID:"behavior-panel"}];return B?e.jsx(S,{title:"Widget Builder",children:e.jsx(u,{children:e.jsxs(d,{gap:"200",inlineAlign:"center",children:[e.jsx(q,{size:"large"}),e.jsx(r,{as:"p",children:"Loading widget builder..."})]})})}):e.jsxs(S,{title:"Widget Builder",subtitle:"Customize your customer-facing loyalty widget",primaryAction:{content:"Get Embed Code",icon:k,onAction:()=>f(!0)},children:[e.jsxs(j,{children:[e.jsxs(j.Section,{children:[e.jsx(u,{children:e.jsxs(d,{gap:"400",children:[e.jsxs(y,{align:"space-between",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Widget Preview"}),e.jsx(s,{label:"Enable Widget",checked:a?.enabled!==!1,onChange:n=>i.mutate({enabled:n})})]}),e.jsx(M,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsx("div",{style:{position:"relative",height:300,display:"flex",alignItems:"flex-end",justifyContent:a?.position?.includes("left")?"flex-start":"flex-end"},children:e.jsx("div",{style:{width:a?.launcher?.size==="large"?70:a?.launcher?.size==="small"?50:60,height:a?.launcher?.size==="large"?70:a?.launcher?.size==="small"?50:60,borderRadius:a?.appearance?.border_radius||16,background:a?.appearance?.primary_color||"#e85d27",display:"flex",alignItems:"center",justifyContent:"center",color:a?.appearance?.text_color||"#fff",fontSize:24,boxShadow:a?.appearance?.shadow?"0 4px 12px rgba(0,0,0,0.15)":"none",cursor:"pointer"},children:a?.launcher?.icon==="gift"?"ðŸŽ":a?.launcher?.icon==="star"?"â­":a?.launcher?.icon==="heart"?"â¤ï¸":a?.launcher?.icon==="trophy"?"ðŸ†":"ðŸŽ"})})})]})}),e.jsx(u,{children:e.jsxs(W,{tabs:L,selected:o,onSelect:E,children:[o===0&&e.jsxs(d,{gap:"400",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Theme"}),e.jsx(y,{gap:"300",wrap:!0,children:A.map(n=>e.jsx(u,{children:e.jsxs(d,{gap:"200",children:[e.jsx(r,{as:"span",variant:"headingSm",children:n.name}),e.jsx(r,{as:"p",variant:"bodySm",tone:"subdued",children:n.description}),e.jsx(y,{gap:"100",children:Object.values(n.appearance).filter(c=>typeof c=="string").slice(0,3).map((c,N)=>e.jsx("div",{style:{width:20,height:20,borderRadius:4,background:c,border:"1px solid #ddd"}},N))}),e.jsx(T,{size:"slim",variant:a?.theme===n.id?"primary":void 0,onClick:()=>z.mutate(n.id),children:a?.theme===n.id?"Applied":"Apply"})]})},n.id))}),e.jsx(p,{}),e.jsx(r,{as:"h3",variant:"headingMd",children:"Colors"}),e.jsxs(l,{children:[e.jsxs(l.Group,{children:[e.jsx(h,{label:"Primary Color",value:a?.appearance?.primary_color||"#e85d27",onChange:n=>i.mutate({appearance:{...a?.appearance,primary_color:n}}),autoComplete:"off"}),e.jsx(h,{label:"Text Color",value:a?.appearance?.text_color||"#ffffff",onChange:n=>i.mutate({appearance:{...a?.appearance,text_color:n}}),autoComplete:"off"})]}),e.jsxs(l.Group,{children:[e.jsx(h,{label:"Background Color",value:a?.appearance?.background_color||"#ffffff",onChange:n=>i.mutate({appearance:{...a?.appearance,background_color:n}}),autoComplete:"off"}),e.jsx(h,{label:"Border Radius",type:"number",value:String(a?.appearance?.border_radius||16),onChange:n=>i.mutate({appearance:{...a?.appearance,border_radius:parseInt(n)}}),suffix:"px",autoComplete:"off"})]})]}),e.jsx(p,{}),e.jsx(r,{as:"h3",variant:"headingMd",children:"Position & Size"}),e.jsxs(l,{children:[e.jsxs(l.Group,{children:[e.jsx(m,{label:"Position",options:Q,value:a?.position||"bottom-right",onChange:n=>i.mutate({position:n})}),e.jsx(m,{label:"Launcher Size",options:U,value:a?.launcher?.size||"medium",onChange:n=>i.mutate({launcher:{...a?.launcher,size:n}})})]}),e.jsxs(l.Group,{children:[e.jsx(m,{label:"Launcher Icon",options:H,value:a?.launcher?.icon||"gift",onChange:n=>i.mutate({launcher:{...a?.launcher,icon:n}})}),e.jsx(m,{label:"Animation",options:J,value:a?.appearance?.animation||"slide",onChange:n=>i.mutate({appearance:{...a?.appearance,animation:n}})})]})]})]}),o===1&&e.jsxs(d,{gap:"400",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Panel Content"}),e.jsxs(l,{children:[e.jsx(s,{label:"Show points balance",checked:a?.panel?.show_points_balance!==!1,onChange:n=>i.mutate({panel:{...a?.panel,show_points_balance:n}})}),e.jsx(s,{label:"Show tier progress",checked:a?.panel?.show_tier_progress!==!1,onChange:n=>i.mutate({panel:{...a?.panel,show_tier_progress:n}})}),e.jsx(s,{label:"Show available rewards",checked:a?.panel?.show_available_rewards!==!1,onChange:n=>i.mutate({panel:{...a?.panel,show_available_rewards:n}})}),e.jsx(s,{label:"Show earning rules",checked:a?.panel?.show_earning_rules!==!1,onChange:n=>i.mutate({panel:{...a?.panel,show_earning_rules:n}})}),e.jsx(s,{label:"Show referral link",checked:a?.panel?.show_referral_link!==!1,onChange:n=>i.mutate({panel:{...a?.panel,show_referral_link:n}})})]}),e.jsx(p,{}),e.jsx(r,{as:"h3",variant:"headingMd",children:"Messages"}),e.jsxs(l,{children:[e.jsx(h,{label:"Welcome Message (Members)",value:a?.panel?.welcome_message||"",onChange:n=>i.mutate({panel:{...a?.panel,welcome_message:n}}),autoComplete:"off"}),e.jsx(h,{label:"Guest Message",value:a?.panel?.guest_message||"",onChange:n=>i.mutate({panel:{...a?.panel,guest_message:n}}),autoComplete:"off"})]}),e.jsx(p,{}),e.jsx(r,{as:"h3",variant:"headingMd",children:"Branding"}),e.jsxs(l,{children:[e.jsx(h,{label:"Program Name",value:a?.branding?.program_name||"Rewards",onChange:n=>i.mutate({branding:{...a?.branding,program_name:n}}),autoComplete:"off"}),e.jsx(s,{label:"Show 'Powered by TradeUp'",checked:a?.branding?.powered_by!==!1,onChange:n=>i.mutate({branding:{...a?.branding,powered_by:n}})})]})]}),o===2&&e.jsxs(d,{gap:"400",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Behavior"}),e.jsxs(l,{children:[e.jsx(s,{label:"Auto-open for new members",checked:a?.behavior?.auto_open_for_new_members!==!1,onChange:n=>i.mutate({behavior:{...a?.behavior,auto_open_for_new_members:n}})}),e.jsx(s,{label:"Close when clicking outside",checked:a?.behavior?.close_on_outside_click!==!1,onChange:n=>i.mutate({behavior:{...a?.behavior,close_on_outside_click:n}})}),e.jsx(s,{label:"Show notifications",checked:a?.behavior?.show_notifications!==!1,onChange:n=>i.mutate({behavior:{...a?.behavior,show_notifications:n}})})]}),e.jsx(p,{}),e.jsx(r,{as:"h3",variant:"headingMd",children:"Display Rules"}),e.jsxs(l,{children:[e.jsx(s,{label:"Hide on mobile devices",checked:a?.display_rules?.hide_on_mobile===!0,onChange:n=>i.mutate({display_rules:{...a?.display_rules,hide_on_mobile:n}})}),e.jsx(s,{label:"Show only for members",checked:a?.display_rules?.show_only_for_members===!0,onChange:n=>i.mutate({display_rules:{...a?.display_rules,show_only_for_members:n}})}),e.jsx(s,{label:"Hide during checkout",checked:a?.display_rules?.hide_during_checkout!==!1,onChange:n=>i.mutate({display_rules:{...a?.display_rules,hide_during_checkout:n}})})]})]})]})})]}),e.jsxs(j.Section,{variant:"oneThird",children:[e.jsx(u,{children:e.jsxs(d,{gap:"300",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Quick Actions"}),e.jsx(T,{fullWidth:!0,onClick:()=>f(!0),icon:k,children:"Get Embed Code"})]})}),e.jsx(u,{children:e.jsxs(d,{gap:"300",children:[e.jsx(r,{as:"h3",variant:"headingMd",children:"Tips"}),e.jsxs(d,{gap:"100",children:[e.jsx(r,{as:"p",variant:"bodyMd",children:"Use colors that match your store theme."}),e.jsx(r,{as:"p",variant:"bodyMd",children:"Keep the widget visible but not intrusive."}),e.jsx(r,{as:"p",variant:"bodyMd",children:"Show points balance to encourage purchases."}),e.jsx(r,{as:"p",variant:"bodyMd",children:"Hide during checkout to avoid distractions."})]})]})})]})]}),e.jsx(I,{open:_,onClose:()=>f(!1),title:"Widget Embed Code",children:e.jsx(I.Section,{children:e.jsxs(d,{gap:"300",children:[e.jsx(r,{as:"p",variant:"bodyMd",children:"Add this code to your theme to display the loyalty widget. The widget will automatically load using your theme app extension."}),e.jsx(M,{padding:"300",background:"bg-surface-secondary",borderRadius:"200",children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:12},children:O?.embed_code||"Loading..."})}),e.jsx(D,{tone:"info",children:"If you're using a Shopify theme, the widget is automatically included via the theme app extension."})]})})})]})}export{ie as EmbeddedWidgetBuilder,ie as default};
