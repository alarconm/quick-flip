import{b as K,u as F,c as v,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as S}from"./vendor-router-CdtyvhQv.js";import{g as h,a as x}from"./index-1mS_NtyG.js";import{P as E,C as c,a as s,l as O,T as t,a3 as I,L as w,a7 as H,h as u,I as R,a9 as N,c as p,z as D,e as m,g as d,$ as V,M as b}from"./vendor-polaris-psd3hcVR.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";async function J(a){const o=await x(`${h()}/page-builder/config`,a);if(!o.ok)throw new Error("Failed to fetch page config");return o.json()}async function U(a){const o=await x(`${h()}/page-builder/templates`,a);if(!o.ok)throw new Error("Failed to fetch templates");return o.json()}const C={hero:"Hero Banner",how_it_works:"How It Works",tier_comparison:"Membership Tiers",rewards_catalog:"Rewards Catalog",earning_rules:"Ways to Earn",faq:"FAQ Section",referral_banner:"Referral Program"};function ae({shop:a}){const[o,L]=S.useState(0),[q,y]=S.useState(!1),[l,P]=S.useState(null),f=K(),{data:_,isLoading:$}=F({queryKey:["page-builder-config",a],queryFn:()=>J(a),enabled:!!a}),{data:z}=F({queryKey:["page-builder-templates",a],queryFn:()=>U(a),enabled:!!a}),g=v({mutationFn:async n=>{const r=await x(`${h()}/page-builder/config`,a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error("Failed to update config");return r.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["page-builder-config",a]})}}),k=v({mutationFn:async n=>{const r=await x(`${h()}/page-builder/templates/${n}/apply`,a,{method:"POST"});if(!r.ok)throw new Error("Failed to apply template");return r.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["page-builder-config",a]})}}),T=v({mutationFn:async({sectionId:n,enabled:r})=>{const j=await x(`${h()}/page-builder/sections/${n}/toggle`,a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:r})});if(!j.ok)throw new Error("Failed to toggle section");return j.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["page-builder-config",a]})}}),i=_?.config,B=z?.templates||[],Q=[{id:"sections",content:"Sections",panelID:"sections-panel"},{id:"design",content:"Design",panelID:"design-panel"},{id:"settings",content:"Settings",panelID:"settings-panel"}];if($)return e.jsx(E,{title:"Loyalty Page Builder",children:e.jsx(c,{children:e.jsxs(s,{gap:"200",inlineAlign:"center",children:[e.jsx(O,{size:"large"}),e.jsx(t,{as:"p",children:"Loading page builder..."})]})})});const M=i?.sections||[],W=M.filter(n=>n.enabled).sort((n,r)=>n.order-r.order),A=M.filter(n=>!n.enabled);return e.jsxs(E,{title:"Loyalty Page Builder",subtitle:"Customize your rewards program landing page",primaryAction:{content:"Preview Page",icon:I,onAction:()=>y(!0)},secondaryActions:[{content:"View Live Page",url:"/apps/rewards",external:!0}],children:[e.jsxs(w,{children:[e.jsx(w.Section,{children:e.jsx(c,{children:e.jsxs(H,{tabs:Q,selected:o,onSelect:L,children:[o===0&&e.jsxs(s,{gap:"400",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:"Active Sections"}),e.jsx(t,{as:"p",variant:"bodyMd",tone:"subdued",children:"Drag to reorder. Toggle to enable/disable sections."}),e.jsx(s,{gap:"200",children:W.map(n=>e.jsx(c,{children:e.jsxs(u,{align:"space-between",blockAlign:"center",children:[e.jsxs(u,{gap:"300",blockAlign:"center",children:[e.jsx(R,{source:N}),e.jsxs(s,{gap:"100",children:[e.jsx(t,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:C[n.type]||n.type}),e.jsx(t,{as:"span",variant:"bodySm",tone:"subdued",children:n.type})]})]}),e.jsxs(u,{gap:"200",children:[e.jsx(p,{size:"slim",onClick:()=>P(n),children:"Edit"}),e.jsx(p,{size:"slim",tone:"critical",onClick:()=>T.mutate({sectionId:n.id,enabled:!1}),children:"Disable"})]})]})},n.id))}),A.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(t,{as:"h3",variant:"headingMd",children:"Available Sections"}),e.jsx(s,{gap:"200",children:A.map(n=>e.jsx(c,{children:e.jsxs(u,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{gap:"100",children:e.jsx(t,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:C[n.type]||n.type})}),e.jsx(p,{size:"slim",onClick:()=>T.mutate({sectionId:n.id,enabled:!0}),children:"Enable"})]})},n.id))})]})]}),o===1&&e.jsxs(s,{gap:"400",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:"Choose a Template"}),e.jsx(u,{gap:"300",wrap:!0,children:B.map(n=>e.jsx(c,{children:e.jsxs(s,{gap:"200",children:[e.jsx(t,{as:"span",variant:"headingSm",children:n.name}),e.jsx(t,{as:"p",variant:"bodySm",tone:"subdued",children:n.description}),e.jsx(u,{gap:"100",children:Object.entries(n.colors).slice(0,3).map(([r,j])=>e.jsx("div",{style:{width:24,height:24,borderRadius:4,background:j,border:"1px solid #ddd"}},r))}),e.jsx(p,{size:"slim",variant:i?.template===n.id?"primary":void 0,onClick:()=>k.mutate(n.id),loading:k.isPending,children:i?.template===n.id?"Applied":"Apply"})]})},n.id))}),e.jsx(D,{}),e.jsx(t,{as:"h3",variant:"headingMd",children:"Colors"}),e.jsx(m,{children:e.jsxs(m.Group,{children:[e.jsx(d,{label:"Primary Color",value:i?.colors?.primary||"#e85d27",onChange:n=>g.mutate({colors:{...i?.colors,primary:n}}),autoComplete:"off"}),e.jsx(d,{label:"Accent Color",value:i?.colors?.accent||"#ffd700",onChange:n=>g.mutate({colors:{...i?.colors,accent:n}}),autoComplete:"off"})]})})]}),o===2&&e.jsxs(s,{gap:"400",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:"Page Settings"}),e.jsxs(m,{children:[e.jsx(V,{label:"Enable loyalty page",checked:i?.enabled!==!1,onChange:n=>g.mutate({enabled:n})}),e.jsx(d,{label:"Page Title",value:i?.meta?.title||"Rewards Program",onChange:n=>g.mutate({meta:{...i?.meta,title:n}}),autoComplete:"off"}),e.jsx(d,{label:"Meta Description",value:i?.meta?.description||"",onChange:n=>g.mutate({meta:{...i?.meta,description:n}}),multiline:2,autoComplete:"off"}),e.jsx(d,{label:"Custom CSS",value:i?.custom_css||"",onChange:n=>g.mutate({custom_css:n}),multiline:4,monospaced:!0,autoComplete:"off",helpText:"Add custom CSS to further customize your page"})]})]})]})})}),e.jsxs(w.Section,{variant:"oneThird",children:[e.jsx(c,{children:e.jsxs(s,{gap:"300",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:"Quick Actions"}),e.jsx(p,{fullWidth:!0,onClick:()=>y(!0),icon:I,children:"Preview Page"}),e.jsx(p,{fullWidth:!0,url:"/apps/rewards",external:!0,children:"View Live Page"})]})}),e.jsx(c,{children:e.jsxs(s,{gap:"300",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:"Tips"}),e.jsxs(s,{gap:"100",children:[e.jsx(t,{as:"p",variant:"bodyMd",children:"Keep your hero section compelling and action-oriented."}),e.jsx(t,{as:"p",variant:"bodyMd",children:'Show 3-4 steps in "How It Works" for clarity.'}),e.jsx(t,{as:"p",variant:"bodyMd",children:"Highlight your best rewards prominently."}),e.jsx(t,{as:"p",variant:"bodyMd",children:"Include an FAQ to reduce support questions."})]})]})})]})]}),e.jsx(b,{open:q,onClose:()=>y(!1),title:"Page Preview",size:"large",children:e.jsx(b.Section,{children:e.jsx("iframe",{src:`${h()}/page-builder/preview`,style:{width:"100%",height:"600px",border:"none"},title:"Page Preview"})})}),l&&e.jsx(b,{open:!!l,onClose:()=>P(null),title:`Edit ${C[l.type]||l.type}`,children:e.jsx(b.Section,{children:e.jsxs(m,{children:[l.type==="hero"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Title",value:l.settings.title||"",onChange:()=>{},autoComplete:"off"}),e.jsx(d,{label:"Subtitle",value:l.settings.subtitle||"",onChange:()=>{},autoComplete:"off"}),e.jsx(d,{label:"Button Text",value:l.settings.cta_text||"",onChange:()=>{},autoComplete:"off"})]}),e.jsx(t,{as:"p",variant:"bodySm",tone:"subdued",children:"Section editing is in preview mode. Full editing coming soon."})]})})})]})}export{ae as EmbeddedPageBuilder,ae as default};
